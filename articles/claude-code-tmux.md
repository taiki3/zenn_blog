---
title: "Claude Code の作業を tmux で永続化して「ターミナル閉じたら仕事終了」を防ぐ"
emoji: "🖥️"
type: "tech"
topics: ["claudecode", "tmux", "ai", "cli", "productivity"]
published: true
---

Claude Code で重いタスク（リファクタリングやテスト作成など）を投げたあと、うっかりターミナルを閉じたり、ネットが切れたりして作業が中断されて絶望したことはありませんか？

`tmux` を活用して、「**ディレクトリごとに自動でセッションを切り替える**」シェル関数を作ると、この問題がスマートに解決します。

## 解決したいこと

* Claude Code (`claude -c`) の実行中にターミナルを閉じても、裏で実行を続けさせたい。
* プロジェクトごとにセッションを分けたい。
* いちいち `tmux new -s ...` と打つのが面倒。

## 結論：この設定を `.zshrc` / `.bashrc` に貼る

以下の関数をシェル設定ファイルに追記してください。

```bash
# Claude Code 永続化用関数
function c() {
    # 1. カレントディレクトリ名を元にユニークなセッション名を作成
    # (例: /Users/name/project-a -> claude-project-a)
    local session_name="claude-$(basename "$PWD" | sed 's/\./-/g')"

    # 2. セッションが既にあればアタッチ、なければ新規作成して 'claude -c' を実行
    # -A: attach or create
    # -d: 他のウィンドウで開いていても横取りしてアタッチする
    tmux new-session -A -s "$session_name" "claude -c"
}

```

## 使い方

設定を反映（`source ~/.zshrc` など）させたら、あとはプロジェクトのディレクトリで **`c`** と打つだけです。

1. **起動:** `c` と打つと、そのディレクトリ専用の Claude Code が立ち上がります。
2. **放置:** 大掛かりな修正を依頼したあと、**ターミナルを X ボタンで閉じてもOK** です。
3. **復帰:** 再び同じディレクトリで `c` と打てば、**さっきの思考プロセスの続き（画面）**に一瞬で戻れます。

## ここがポイント

### 1. `claude -c` によるコンテキスト維持

Claude Code は `-c` (sticky context) フラグを使うことで、前回の会話の流れを汲み取ってくれます。この関数はそれをデフォルトで叩くようにしています。

### 2. ディレクトリ名による自動セッション分離

`basename "$PWD"` をセッション名に組み込んでいるため、

* `~/work/project-A` で `c` を叩けば `claude-project-A` セッション
* `~/work/project-B` で `c` を叩けば `claude-project-B` セッション
という具合に、AIの思考ルームがディレクトリ単位で自動的に隔離・保存されます。

### 3. `tmux new-session -A` の魔法

このオプションのおかげで、「新規作成」と「再開」を意識しなくて済みます。セッションがなければ作り、あればそこに入る。ユーザーは常に `c` と打つだけで済みます。

---

## 便利な tmux コマンド集

この運用を始めると、裏で動いている Claude たちを管理したくなります。

| やりたいこと | コマンド |
| --- | --- |
| **稼働中の AI 一覧を見る** | `tmux ls` |
| **AI の作業から一時離脱する** | `Ctrl + b` -> `d` |
| **AI の作業を完全に終了する** | (Claude 内で) `exit` または `Ctrl + d` |
| **全ディレクトリの AI を一斉終了** | `tmux kill-server` |

## まとめ

AI エージェントは「考えている時間」が長いツールです。
`tmux` という古き良きツールと組み合わせることで、現代のエージェント AI の体験がぐっと快適になります。

ぜひお試しください。
